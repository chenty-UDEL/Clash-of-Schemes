# 测试模式使用说明

## 功能概述

测试模式允许玩家选择任意角色进行单机测试，系统会自动创建6-8个AI玩家并自动进行游戏，帮助玩家快速测试角色技能。

## 功能特性

### 1. 测试房间创建
- 访问 `/test` 页面进入测试模式
- 输入玩家昵称
- 选择要测试的角色
- 选择游戏板子（命运之轮/均衡法则/策略之巅/自定义）
- 点击"开始测试"创建测试房间

### 2. AI玩家自动创建
- 系统自动创建6-8个AI玩家
- AI玩家名称以"AI-"开头（如：AI-阿尔法、AI-贝塔等）
- AI玩家会自动分配角色（从选择的板子中随机分配）

### 3. AI自动行动
- **夜晚阶段**：玩家提交行动后，AI玩家会自动提交夜晚行动
- **白天阶段**：玩家投票后，AI玩家会自动投票
- AI会根据角色技能自动选择合适的行动

### 4. 游戏流程
- 测试模式下的游戏流程与正常游戏完全相同
- 玩家可以手动结算夜晚或白天阶段
- 游戏会正常进行直到结束

## 文件结构

```
app/
├── test/
│   └── page.tsx              # 测试模式页面
└── api/
    └── test/
        ├── create/
        │   └── route.ts      # 创建测试房间和AI玩家
        └── auto-action/
            └── route.ts      # AI自动行动逻辑
```

## API端点

### POST `/api/test/create`
创建测试房间和AI玩家

**请求体：**
```json
{
  "playerName": "玩家昵称",
  "selectedRole": "技能观测者",
  "boardType": "custom"
}
```

**响应：**
```json
{
  "success": true,
  "data": {
    "roomCode": "TEST1234",
    "playerId": 1,
    "botCount": 6,
    "totalPlayers": 7
  }
}
```

### POST `/api/test/auto-action`
触发AI自动行动

**请求体：**
```json
{
  "roomCode": "TEST1234",
  "phase": "night"  // 或 "day"
}
```

## AI行为逻辑

### 夜晚行动
AI会根据角色自动选择行动：
- **技能观测者**：随机观察一个玩家
- **利他守护者**：随机保护一个玩家
- **沉默制裁者**：随机禁言一个玩家
- **投票阻断者**：随机阻止一个玩家投票
- **同盟者/影子胜者/命运复制者**：仅第一夜可以行动
- **命运转移者**：随机转移命运
- **胜利夺取者**：随机锁定目标
- **心灵胜者**：随机预测投票
- **投票回收者**：存储投票

### 白天投票
- AI有30%概率弃票
- 70%概率随机投票给一个存活玩家

## 使用流程

1. **进入测试模式**
   - 在主页点击"进入测试模式"按钮
   - 或直接访问 `/test` 页面

2. **选择角色和板子**
   - 输入玩家昵称
   - 选择要测试的角色
   - 选择游戏板子

3. **开始测试**
   - 点击"开始测试"按钮
   - 系统自动创建测试房间和AI玩家
   - 自动跳转到游戏页面

4. **进行游戏**
   - 正常进行游戏操作
   - AI会自动行动和投票
   - 可以随时手动结算阶段

## 注意事项

1. **测试房间标识**：测试房间号以"TEST"开头，方便识别
2. **AI玩家识别**：AI玩家名称以"AI-"开头
3. **数据库字段**：系统通过玩家名称前缀识别AI，不需要额外的数据库字段
4. **自动触发**：AI行动会在玩家提交行动/投票后自动触发

## 技术实现

### AI识别方式
由于数据库可能没有`is_bot`字段，系统通过以下方式识别AI玩家：
- 优先检查`is_bot`字段（如果存在）
- 否则通过名称前缀判断（`AI-`开头）

### 自动触发机制
- 在`app/page.tsx`中，当玩家提交行动或投票后，如果是测试模式，会自动调用`/api/test/auto-action`
- 延迟500ms后刷新数据，确保AI行动已提交

## 未来改进

1. **更智能的AI**：实现更复杂的AI决策逻辑
2. **测试统计**：记录测试结果和统计数据
3. **快速测试**：支持快速测试多个角色
4. **AI难度设置**：可调整AI的智能程度


