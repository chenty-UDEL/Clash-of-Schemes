# 完整版权谋决战对比分析

## 一、角色对比

### 当前实现（15个角色）✅
1. 技能观测者 ✅
2. 利他守护者 ✅
3. 投票阻断者 ✅
4. 沉默制裁者 ✅
5. 同盟者 ✅
6. 减票守护者 ✅
7. 双票使者 ✅
8. 平票终结者 ✅
9. 影子胜者 ✅
10. 集票胜者 ✅
11. 三人王者 ✅
12. 免票胜者 ✅
13. 平票赢家 ✅
14. 票数平衡者 ✅
15. 多选胜者 ✅

### 完整版（22个角色）

#### 缺失的角色（7个）❌
1. **反向投票者** - 当你被投票出局时，选择一名投你的人代替你出局，技能只能使用一次
2. **均衡守护者** - 当出现平票时，你可以打破平局，技能只能使用一次
3. **命运复制者** - 第一天晚上选择一个角色，拥有该角色的技能，但如果选的玩家死亡了自己也跟着死亡（代码中提到了但未实现）
4. **心灵胜者** - 你可以每晚预测一名其他玩家的投票，如果连续a次预测成功，你立即获胜（a为总人数的1/2，向上取整）
5. **命运转移者** - 在每个夜晚，你可以选择将自己与另一名玩家的命运调换。如果该玩家在接下来的白天被淘汰，你将代替他出局，反之亦然
6. **投票回收者** - 你可以在每个白天保留一张未使用的投票，最多保留3张。在任何一轮投票时，你可以同时使用所有存储的投票
7. **胜利夺取者** - 你可以在夜晚选择一名玩家并夺取其特殊胜利条件，如果该玩家本轮获胜，则改为你立即获胜，否则你死亡，你可以普通获胜

## 二、游戏机制对比

### 当前实现 ✅
- 基本游戏流程（夜晚→白天→投票）
- 基础计票逻辑
- 部分胜利条件判定
- 角色技能部分实现

### 完整版要求 ❌

#### 1. 板子系统（缺失）
- **板子1：命运之轮** - 13个角色
- **板子2：均衡法则** - 13个角色
- **板子3：策略之巅** - 13个角色
- 当前：随机分配所有角色
- 需要：支持选择板子，每个板子固定13个角色

#### 2. 行动顺序系统（缺失）
**夜晚行动顺序：**
1. 命运复制者
2. 技能观测者
3. 命运转移者
4. 利他守护者
5. 投票阻断者
6. 沉默制裁者
7. 同盟者（仅在第一个夜晚）
8. 影子胜者（仅在第一个夜晚）

**白天行动顺序：**
1. 利他守护者
2. 沉默制裁者
3. 双票使者
4. 投票阻断者
5. 影子胜者
6. 均衡守护者
7. 平票终结者

当前：无顺序，同时处理
需要：按顺序处理技能效果

#### 3. 死局判定（缺失）
- 规则：连续出现3次相同的技能和投票情况
- 当前：未实现
- 需要：记录历史状态，检测死局

#### 4. 游戏人数限制（缺失）
- 规则：6-13人
- 当前：无限制
- 需要：添加人数验证

#### 5. 投票规则细节（部分缺失）
- 平票时公布平票玩家和被投票数 ✅（部分实现）
- 可以投自己 ✅（已支持）
- 可以不投票 ✅（已支持）

## 三、角色技能实现状态

### 已完全实现 ✅
- 技能观测者
- 利他守护者
- 投票阻断者
- 沉默制裁者
- 同盟者
- 减票守护者
- 双票使者
- 平票终结者
- 影子胜者
- 集票胜者
- 三人王者
- 免票胜者
- 平票赢家
- 票数平衡者
- 多选胜者

### 需要完善 ⚠️
- **多选胜者**：规则描述有变化
  - 当前：连续a轮投死不同人
  - 完整版：连续a轮给不同的玩家投票，且这些玩家都在接下来的a轮中被淘汰

### 完全缺失 ❌
1. 反向投票者
2. 均衡守护者
3. 命运复制者
4. 心灵胜者
5. 命运转移者
6. 投票回收者
7. 胜利夺取者

## 四、数据库需求

### 当前表结构（推断）
- rooms: code, round_state, ...
- players: id, room_code, name, role, is_alive, flags, ...
- votes: room_code, voter_id, target_id, round_number
- night_actions: room_code, actor_id, target_id, action_type, round_number
- game_logs: id, room_code, message, viewer_ids, tag, created_at

### 需要新增字段/表
1. **rooms表新增：**
   - board_type: 'fate' | 'balance' | 'strategy' | 'custom'（板子类型）
   - deadlock_count: number（死局计数）
   - last_state_hash: string（用于死局检测）

2. **players表新增：**
   - stored_votes: number（投票回收者存储的票数）
   - vote_predictions: array（心灵胜者的预测记录）
   - fate_target_id: number（命运转移者的目标）
   - copied_role: string（命运复制者复制的角色）
   - copied_from_id: number（命运复制者复制的来源玩家ID）

3. **新增表：game_states**
   - id, room_code, round_number, state_hash, created_at
   - 用于死局检测

4. **新增表：vote_predictions**
   - id, room_code, predictor_id, predicted_player_id, predicted_target_id, round_number, is_correct
   - 用于心灵胜者

## 五、优先级排序

### P0 - 核心功能（必须实现）
1. 实现7个缺失角色
2. 板子系统
3. 行动顺序系统
4. 死局判定

### P1 - 重要功能（应该实现）
1. 游戏人数限制
2. 投票规则完善
3. 多选胜者规则修正

### P2 - 优化功能（可以后续实现）
1. 代码重构
2. 性能优化
3. UI/UX优化




